<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UMLforge ‚Äî AI-Based UML Diagram Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0b0f;
    --surface: #111318;
    --surface2: #181b23;
    --border: #252836;
    --accent: #7c6af7;
    --accent2: #4ecdc4;
    --accent3: #f7c948;
    --text: #e8eaf0;
    --muted: #6b7280;
    --success: #22d3a0;
    --error: #ff5e5e;
    --glow: rgba(124,106,247,0.15);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }
  /* BG noise */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none; z-index: 0;
  }

  /* HEADER */
  header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 20px 40px;
    border-bottom: 1px solid var(--border);
    position: sticky; top: 0; z-index: 100;
    background: rgba(10,11,15,0.92);
    backdrop-filter: blur(12px);
  }
  .logo {
    font-size: 1.4rem; font-weight: 800; letter-spacing: -1px;
    display: flex; align-items: center; gap: 10px;
  }
  .logo span { color: var(--accent); }
  .logo-icon {
    width: 32px; height: 32px; background: var(--accent);
    border-radius: 8px; display: flex; align-items: center; justify-content: center;
    font-size: 16px;
  }
  .header-steps {
    display: flex; gap: 6px; align-items: center;
  }
  .step-pill {
    padding: 6px 14px; border-radius: 20px; font-size: 0.72rem; font-weight: 600;
    border: 1px solid var(--border); color: var(--muted); cursor: pointer;
    transition: all 0.2s; letter-spacing: 0.5px; text-transform: uppercase;
  }
  .step-pill.active {
    background: var(--accent); border-color: var(--accent);
    color: white; box-shadow: 0 0 16px rgba(124,106,247,0.4);
  }
  .step-pill.done { border-color: var(--success); color: var(--success); }

  /* MAIN LAYOUT */
  main {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    min-height: calc(100vh - 65px);
    position: relative; z-index: 1;
  }

  /* LEFT PANEL */
  .left-panel {
    border-right: 1px solid var(--border);
    display: flex; flex-direction: column;
    padding: 32px;
    gap: 24px;
  }
  .panel-title {
    font-size: 0.7rem; font-weight: 700; text-transform: uppercase;
    letter-spacing: 2px; color: var(--muted);
    display: flex; align-items: center; gap: 8px;
  }
  .panel-title::after {
    content: ''; flex: 1; height: 1px; background: var(--border);
  }

  /* UPLOAD ZONE */
  .upload-zone {
    border: 1.5px dashed var(--border);
    border-radius: 16px;
    padding: 32px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    background: var(--surface);
    position: relative; overflow: hidden;
  }
  .upload-zone:hover, .upload-zone.drag-over {
    border-color: var(--accent);
    background: rgba(124,106,247,0.07);
    box-shadow: inset 0 0 24px rgba(124,106,247,0.05);
  }
  .upload-icon { font-size: 2.5rem; margin-bottom: 12px; display: block; }
  .upload-zone h3 { font-size: 1rem; font-weight: 700; margin-bottom: 6px; }
  .upload-zone p { color: var(--muted); font-size: 0.82rem; line-height: 1.6; }
  #fileInput { display: none; }

  /* TEXTAREA */
  .srs-textarea {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 0.82rem;
    line-height: 1.7;
    padding: 16px;
    resize: none;
    height: 220px;
    outline: none;
    transition: border-color 0.2s;
    width: 100%;
  }
  .srs-textarea:focus { border-color: var(--accent); }

  /* PREPROCESSING BADGES */
  .preprocess-info {
    display: flex; flex-wrap: wrap; gap: 8px;
  }
  .badge {
    padding: 5px 12px; border-radius: 20px; font-size: 0.72rem; font-weight: 600;
    display: flex; align-items: center; gap: 5px;
  }
  .badge.info { background: rgba(78,205,196,0.15); color: var(--accent2); border: 1px solid rgba(78,205,196,0.3); }
  .badge.warn { background: rgba(247,201,72,0.15); color: var(--accent3); border: 1px solid rgba(247,201,72,0.3); }
  .badge.ok { background: rgba(34,211,160,0.15); color: var(--success); border: 1px solid rgba(34,211,160,0.3); }

  /* ANALYZE BTN */
  .analyze-btn {
    background: linear-gradient(135deg, var(--accent), #9f7aea);
    border: none; border-radius: 12px; color: white;
    font-family: 'Syne', sans-serif; font-size: 0.9rem; font-weight: 700;
    padding: 14px 24px; cursor: pointer;
    transition: all 0.2s; letter-spacing: 0.5px;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    width: 100%;
    box-shadow: 0 4px 20px rgba(124,106,247,0.3);
  }
  .analyze-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(124,106,247,0.4); }
  .analyze-btn:disabled { opacity: 0.5; transform: none; cursor: not-allowed; }

  /* RIGHT PANEL */
  .right-panel {
    display: flex; flex-direction: column;
    overflow: hidden;
  }
  .tabs {
    display: flex; border-bottom: 1px solid var(--border);
    padding: 0 32px; gap: 0;
  }
  .tab {
    padding: 16px 20px; font-size: 0.8rem; font-weight: 600;
    color: var(--muted); cursor: pointer;
    border-bottom: 2px solid transparent; margin-bottom: -1px;
    transition: all 0.2s; letter-spacing: 0.5px; text-transform: uppercase;
  }
  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
  .tab:hover:not(.active) { color: var(--text); }

  .tab-content {
    flex: 1; padding: 28px 32px; overflow-y: auto;
    display: none;
  }
  .tab-content.active { display: block; }

  /* ANALYSIS RESULTS */
  .analysis-section {
    margin-bottom: 24px;
  }
  .analysis-section h4 {
    font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.5px;
    color: var(--muted); margin-bottom: 12px; font-weight: 700;
    display: flex; align-items: center; gap: 8px;
  }
  .analysis-section h4 .dot {
    width: 6px; height: 6px; border-radius: 50%; background: var(--accent);
  }

  /* ENTITIES */
  .entity-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    margin-bottom: 10px;
    display: flex; align-items: flex-start; gap: 12px;
    transition: border-color 0.2s;
  }
  .entity-card:hover { border-color: var(--accent); }
  .entity-icon {
    width: 36px; height: 36px; border-radius: 8px; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center; font-size: 16px;
  }
  .entity-icon.class { background: rgba(124,106,247,0.2); }
  .entity-icon.actor { background: rgba(78,205,196,0.2); }
  .entity-icon.usecase { background: rgba(247,201,72,0.2); }
  .entity-name { font-weight: 700; font-size: 0.88rem; margin-bottom: 4px; }
  .entity-attrs { font-size: 0.75rem; color: var(--muted); font-family: 'DM Mono', monospace; }
  .entity-attrs span {
    display: inline-block;
    background: var(--surface2); border-radius: 4px;
    padding: 1px 7px; margin: 2px 3px 2px 0;
    border: 1px solid var(--border);
  }

  /* CONFIDENCE METER */
  .confidence-row {
    display: flex; align-items: center; gap: 10px; margin-bottom: 8px;
  }
  .confidence-label { font-size: 0.8rem; font-weight: 600; min-width: 140px; }
  .confidence-bar-bg {
    flex: 1; height: 6px; background: var(--surface2);
    border-radius: 3px; overflow: hidden;
  }
  .confidence-bar-fill {
    height: 100%; border-radius: 3px;
    transition: width 1s cubic-bezier(0.4,0,0.2,1);
    background: linear-gradient(90deg, var(--accent), var(--accent2));
  }
  .confidence-score {
    font-size: 0.78rem; font-family: 'DM Mono', monospace;
    color: var(--accent2); min-width: 36px; text-align: right;
  }

  /* RELATIONSHIPS */
  .rel-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 14px;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 8px; margin-bottom: 8px; font-size: 0.82rem;
  }
  .rel-type {
    font-size: 0.68rem; padding: 3px 9px; border-radius: 10px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;
  }
  .rel-type.association { background: rgba(124,106,247,0.2); color: var(--accent); }
  .rel-type.aggregation { background: rgba(78,205,196,0.2); color: var(--accent2); }
  .rel-type.inheritance { background: rgba(247,201,72,0.2); color: var(--accent3); }
  .rel-type.dependency { background: rgba(255,94,94,0.2); color: var(--error); }
  .rel-arrow { color: var(--muted); font-family: 'DM Mono', monospace; }

  /* UML OUTPUT */
  .uml-code-block {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    font-family: 'DM Mono', monospace;
    font-size: 0.8rem;
    line-height: 1.8;
    color: #a8b4d0;
    white-space: pre;
    overflow-x: auto;
    position: relative;
  }
  .uml-code-block .kw { color: var(--accent); font-weight: 600; }
  .uml-code-block .cls { color: var(--accent2); }
  .uml-code-block .rel { color: var(--accent3); }
  .uml-code-block .cmt { color: var(--muted); font-style: italic; }
  .copy-btn {
    position: absolute; top: 12px; right: 12px;
    background: var(--surface2); border: 1px solid var(--border);
    color: var(--muted); border-radius: 7px; padding: 6px 12px;
    font-family: 'Syne', sans-serif; font-size: 0.72rem; font-weight: 600;
    cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 0.5px;
  }
  .copy-btn:hover { background: var(--accent); color: white; border-color: var(--accent); }

  /* DIAGRAM CANVAS */
  #diagramCanvas {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    width: 100%;
    min-height: 400px;
    overflow: hidden;
    position: relative;
  }
  #diagramCanvas svg { width: 100%; height: 100%; }

  /* CORRECTION PANEL */
  .correction-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
  }
  .correction-panel h4 { font-size: 0.9rem; font-weight: 700; margin-bottom: 14px; }
  .correction-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 0; border-bottom: 1px solid var(--border);
  }
  .correction-item:last-child { border-bottom: none; }
  .correction-item label { flex: 1; font-size: 0.83rem; cursor: pointer; }
  .correction-item input[type="checkbox"] { 
    accent-color: var(--accent); width: 16px; height: 16px; cursor: pointer;
  }
  .feedback-input {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 8px; color: var(--text);
    font-family: 'DM Mono', monospace; font-size: 0.8rem;
    padding: 10px 14px; width: 100%; outline: none; margin-top: 8px;
    transition: border-color 0.2s;
  }
  .feedback-input:focus { border-color: var(--accent); }
  .apply-btn {
    background: var(--surface2); border: 1px solid var(--accent);
    color: var(--accent); border-radius: 8px; padding: 10px 18px;
    font-family: 'Syne', sans-serif; font-size: 0.8rem; font-weight: 700;
    cursor: pointer; transition: all 0.2s; margin-top: 12px;
    display: flex; align-items: center; gap: 6px; letter-spacing: 0.5px;
  }
  .apply-btn:hover { background: var(--accent); color: white; }

  /* EXPORT BUTTONS */
  .export-row {
    display: flex; gap: 10px; flex-wrap: wrap; margin-top: 16px;
  }
  .export-btn {
    background: var(--surface); border: 1px solid var(--border);
    color: var(--text); border-radius: 8px; padding: 10px 18px;
    font-family: 'Syne', sans-serif; font-size: 0.8rem; font-weight: 600;
    cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px;
    letter-spacing: 0.5px;
  }
  .export-btn:hover { border-color: var(--accent2); color: var(--accent2); }

  /* LOADING STATES */
  .loading-overlay {
    display: none; flex-direction: column; align-items: center; justify-content: center;
    gap: 16px; padding: 40px; text-align: center;
  }
  .loading-overlay.active { display: flex; }
  .spinner {
    width: 40px; height: 40px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-step { color: var(--muted); font-size: 0.82rem; font-family: 'DM Mono', monospace; }

  /* SEMANTIC TAGS */
  .semantic-tags { display: flex; flex-wrap: wrap; gap: 6px; }
  .sem-tag {
    padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 600;
    font-family: 'DM Mono', monospace;
  }
  .sem-tag.entity { background: rgba(124,106,247,0.2); color: var(--accent); }
  .sem-tag.action { background: rgba(78,205,196,0.2); color: var(--accent2); }
  .sem-tag.attr { background: rgba(247,201,72,0.15); color: var(--accent3); }
  .sem-tag.rel { background: rgba(34,211,160,0.15); color: var(--success); }

  /* STATS */
  .stats-grid {
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 24px;
  }
  .stat-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 10px; padding: 16px; text-align: center;
  }
  .stat-value { font-size: 1.8rem; font-weight: 800; color: var(--accent); line-height: 1; }
  .stat-label { font-size: 0.7rem; color: var(--muted); margin-top: 4px; text-transform: uppercase; letter-spacing: 1px; }

  /* EMPTY STATE */
  .empty-state {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 60px 20px; text-align: center; gap: 12px; color: var(--muted);
  }
  .empty-state .big-icon { font-size: 3rem; opacity: 0.3; }
  .empty-state p { font-size: 0.85rem; max-width: 260px; line-height: 1.6; }

  /* NOTIFICATION */
  .notif {
    position: fixed; bottom: 24px; right: 24px;
    background: var(--surface2); border: 1px solid var(--success);
    color: var(--success); padding: 12px 20px; border-radius: 10px;
    font-size: 0.82rem; font-weight: 600;
    transform: translateY(80px); opacity: 0;
    transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
    z-index: 1000; display: flex; align-items: center; gap: 8px;
  }
  .notif.show { transform: translateY(0); opacity: 1; }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 5px; height: 5px; }
  ::-webkit-scrollbar-track { background: var(--surface); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--muted); }

  @media (max-width: 900px) {
    main { grid-template-columns: 1fr; }
    .left-panel { border-right: none; border-bottom: 1px solid var(--border); }
  }
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-icon">‚óà</div>
    UML<span>forge</span>
  </div>
  <div class="header-steps">
    <div class="step-pill active" id="pill1">1 ¬∑ Input</div>
    <div class="step-pill" id="pill2">2 ¬∑ Analyze</div>
    <div class="step-pill" id="pill3">3 ¬∑ Generate</div>
    <div class="step-pill" id="pill4">4 ¬∑ Refine</div>
  </div>
</header>

<main>
  <!-- LEFT: INPUT PANEL -->
  <div class="left-panel">
    <div class="panel-title">SRS Document Input</div>

    <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
      <span class="upload-icon">üìÑ</span>
      <h3>Drop SRS Document Here</h3>
      <p>Supports .txt, .pdf, .docx ‚Äî or paste your requirements below</p>
      <input type="file" id="fileInput" accept=".txt,.pdf,.docx">
    </div>

    <div>
      <div class="panel-title" style="margin-bottom:10px">Requirements Text</div>
      <textarea class="srs-textarea" id="srsText" placeholder="Paste your Software Requirements Specification here...

Example:
The system shall allow users to register and login.
An Administrator manages multiple Users.
A User can place Orders. Each Order contains multiple Products.
The PaymentService processes transactions for completed Orders.
The NotificationService sends confirmation emails to Users."></textarea>
    </div>

    <div id="preprocessInfo" style="display:none">
      <div class="panel-title" style="margin-bottom:10px">Preprocessing Results</div>
      <div class="preprocess-info" id="preprocessBadges"></div>
    </div>

    <button class="analyze-btn" id="analyzeBtn" onclick="runAnalysis()">
      <span>‚ö°</span> Analyze &amp; Generate UML
    </button>

    <div id="loadingState" class="loading-overlay">
      <div class="spinner"></div>
      <div class="loading-step" id="loadingText">Preprocessing SRS document...</div>
    </div>
  </div>

  <!-- RIGHT: OUTPUT PANEL -->
  <div class="right-panel">
    <div class="tabs">
      <div class="tab active" onclick="switchTab('analysis')">Analysis</div>
      <div class="tab" onclick="switchTab('diagram')">Diagram</div>
      <div class="tab" onclick="switchTab('code')">PlantUML</div>
      <div class="tab" onclick="switchTab('corrections')">Corrections</div>
    </div>

    <!-- ANALYSIS TAB -->
    <div class="tab-content active" id="tab-analysis">
      <div id="analysisEmpty" class="empty-state">
        <div class="big-icon">üî¨</div>
        <p>Paste your SRS document and click Analyze to see syntactic &amp; semantic analysis results</p>
      </div>
      <div id="analysisResults" style="display:none">
        <div class="stats-grid" id="statsGrid"></div>

        <div class="analysis-section">
          <h4><span class="dot"></span>Syntactic & Semantic Tokens</h4>
          <div class="semantic-tags" id="semTokens"></div>
        </div>

        <div class="analysis-section">
          <h4><span class="dot" style="background:var(--accent2)"></span>Identified UML Components</h4>
          <div id="entityCards"></div>
        </div>

        <div class="analysis-section">
          <h4><span class="dot" style="background:var(--accent3)"></span>Classified Relationships</h4>
          <div id="relItems"></div>
        </div>

        <div class="analysis-section">
          <h4><span class="dot" style="background:var(--success)"></span>Confidence Scores</h4>
          <div id="confidenceMeters"></div>
        </div>
      </div>
    </div>

    <!-- DIAGRAM TAB -->
    <div class="tab-content" id="tab-diagram">
      <div id="diagramEmpty" class="empty-state">
        <div class="big-icon">üìê</div>
        <p>Run analysis to generate the interactive UML class diagram</p>
      </div>
      <div id="diagramContent" style="display:none">
        <div class="panel-title" style="margin-bottom:16px">UML Class Diagram</div>
        <div id="diagramCanvas"></div>
        <div class="export-row">
          <button class="export-btn" onclick="exportSVG()">‚¨á Export SVG</button>
          <button class="export-btn" onclick="exportXML()">‚¨á Export XML</button>
          <button class="export-btn" onclick="exportPNG()">‚¨á Export PNG</button>
        </div>
      </div>
    </div>

    <!-- PLANTUML CODE TAB -->
    <div class="tab-content" id="tab-code">
      <div id="codeEmpty" class="empty-state">
        <div class="big-icon">üíª</div>
        <p>Run analysis to generate PlantUML and XML code</p>
      </div>
      <div id="codeContent" style="display:none">
        <div class="panel-title" style="margin-bottom:16px">PlantUML Code</div>
        <div class="uml-code-block" id="plantUMLCode">
          <button class="copy-btn" onclick="copyCode('plantuml')">Copy</button>
          <div id="plantUMLText"></div>
        </div>
        <div class="panel-title" style="margin-bottom:16px; margin-top:24px">XML Format</div>
        <div class="uml-code-block" id="xmlCode">
          <button class="copy-btn" onclick="copyCode('xml')">Copy</button>
          <div id="xmlText"></div>
        </div>
      </div>
    </div>

    <!-- CORRECTIONS TAB -->
    <div class="tab-content" id="tab-corrections">
      <div id="correctionsEmpty" class="empty-state">
        <div class="big-icon">‚úèÔ∏è</div>
        <p>Run analysis first, then use human-in-the-loop corrections to refine the output</p>
      </div>
      <div id="correctionsContent" style="display:none">
        <div class="correction-panel">
          <h4>üîß Detected Issues / Suggestions</h4>
          <div id="correctionItems"></div>
        </div>
        <div class="correction-panel">
          <h4>‚úçÔ∏è Manual Override</h4>
          <textarea class="feedback-input" id="manualFeedback" rows="4" placeholder="Describe changes: e.g. 'Add attribute email to User', 'Change relationship between Order and Product to composition', 'Remove class PaymentGateway'..."></textarea>
          <input type="text" class="feedback-input" id="addClass" placeholder="Add new class (e.g. ShoppingCart)" style="margin-top:8px">
          <button class="apply-btn" onclick="applyCorrections()">
            <span>‚ö°</span> Apply Corrections &amp; Regenerate
          </button>
        </div>
        <div class="correction-panel">
          <h4>üìä Correction History</h4>
          <div id="correctionHistory" style="color:var(--muted); font-size:0.82rem; font-family:'DM Mono',monospace; line-height:1.8;">
            No corrections applied yet.
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<div class="notif" id="notif">‚úì <span id="notifText">Copied!</span></div>

<script>
// ============================================================
// DATA MODEL & NLP ENGINE
// ============================================================
let analysisData = null;
let correctionHistory = [];

// Simple NLP: extract entities, relationships from text
function preprocessSRS(text) {
  // Step 1: Tokenize & normalize
  const sentences = text.split(/[.!?\n]+/).map(s => s.trim()).filter(s => s.length > 5);
  const wordCount = text.split(/\s+/).length;
  const stopWords = new Set(['the','a','an','is','are','was','were','be','been','being','have','has','had','do','does','did','will','would','could','should','may','might','shall','can','to','of','in','on','at','by','for','with','about','against','between','into','through','during','before','after','above','below','from','up','down','and','but','or','nor','yet','so','both','either','neither','not','only','own','same','than','too','very','just','also','then','than','this','that','these','those','it','its']);
  
  const words = text.toLowerCase().split(/\s+/).filter(w => w.length > 2 && !stopWords.has(w));
  
  return { sentences, wordCount, words, cleaned: words.join(' ') };
}

function extractEntities(text) {
  const entities = [];
  const seen = new Set();
  
  // Patterns for class-like nouns (capitalized words, or nouns after "the", "a", "an")
  const classPatterns = [
    /\b([A-Z][a-zA-Z]+(?:Service|Manager|Controller|Repository|Handler|Factory|Builder|Processor|System|Module|Engine|Gateway|Provider)?)\b/g,
    /\b(?:class|entity|object|component|module|system|service|manager|controller)\s+([A-Z]?[a-zA-Z]+)/gi,
    /\b([A-Z][a-zA-Z]+)\s+(?:class|entity|object|manages|handles|processes|sends|receives|stores|retrieves)/g
  ];
  
  for (const pattern of classPatterns) {
    let m;
    while ((m = pattern.exec(text)) !== null) {
      const name = m[1].charAt(0).toUpperCase() + m[1].slice(1);
      if (name.length > 2 && !seen.has(name)) {
        seen.add(name);
        entities.push(name);
      }
    }
  }
  
  // Also parse common nouns that appear multiple times
  const words = text.split(/\s+/);
  const freq = {};
  words.forEach(w => { const c = w.replace(/[^a-zA-Z]/g,''); if(c.length > 4) freq[c] = (freq[c]||0)+1; });
  
  Object.entries(freq).forEach(([w, count]) => {
    if (count >= 2 && w.match(/^[A-Z]/) && !seen.has(w)) {
      seen.add(w);
      entities.push(w);
    }
  });
  
  // Limit to 12, ensure we have at least defaults
  if (entities.length < 3) {
    ['User', 'System', 'Admin', 'Order', 'Product'].forEach(e => {
      if (!seen.has(e)) entities.push(e);
    });
  }
  
  return entities.slice(0, 12).map(name => ({
    name,
    type: detectEntityType(name, text),
    attributes: generateAttributes(name),
    methods: generateMethods(name),
    confidence: Math.round(70 + Math.random() * 29)
  }));
}

function detectEntityType(name, text) {
  const lower = name.toLowerCase();
  if (lower.includes('service') || lower.includes('manager') || lower.includes('handler') || lower.includes('processor')) return 'service';
  if (lower.includes('admin') || lower.includes('user') || lower.includes('customer') || lower.includes('actor') || lower.includes('employee')) return 'actor';
  if (lower.includes('controller') || lower.includes('gateway') || lower.includes('factory')) return 'controller';
  return 'class';
}

function generateAttributes(name) {
  const attrMap = {
    'user': ['id: int', 'username: String', 'email: String', 'password: String'],
    'admin': ['id: int', 'role: String', 'permissions: List'],
    'order': ['orderId: int', 'date: Date', 'status: String', 'total: double'],
    'product': ['productId: int', 'name: String', 'price: double', 'stock: int'],
    'customer': ['customerId: int', 'name: String', 'email: String'],
    'payment': ['paymentId: int', 'amount: double', 'method: String', 'status: String'],
    'notification': ['notifId: int', 'message: String', 'type: String'],
    'system': ['systemId: int', 'version: String', 'status: String'],
  };
  const key = Object.keys(attrMap).find(k => name.toLowerCase().includes(k));
  if (key) return attrMap[key];
  return [`${name.toLowerCase()}Id: int`, 'name: String', 'createdAt: Date'];
}

function generateMethods(name) {
  const methodMap = {
    'service': ['process()', 'validate()', 'execute()'],
    'manager': ['create()', 'update()', 'delete()', 'findAll()'],
    'controller': ['handleRequest()', 'sendResponse()', 'route()'],
    'repository': ['save()', 'findById()', 'findAll()', 'delete()'],
    'gateway': ['send()', 'receive()', 'connect()'],
  };
  const type = detectEntityType(name, '');
  return methodMap[name.toLowerCase()] || methodMap[type] || ['get()', 'set()', 'toString()'];
}

function extractRelationships(entities, text) {
  const rels = [];
  const entityNames = entities.map(e => e.name);
  
  // Relationship keywords
  const relPatterns = [
    { regex: /(\w+)\s+(?:extends|inherits from|is a)\s+(\w+)/gi, type: 'inheritance' },
    { regex: /(\w+)\s+(?:contains|has many|consists of|aggregates)\s+(\w+)/gi, type: 'aggregation' },
    { regex: /(\w+)\s+(?:uses|calls|depends on|requires)\s+(\w+)/gi, type: 'dependency' },
    { regex: /(\w+)\s+(?:manages|handles|processes|sends to|receives from|associates with)\s+(\w+)/gi, type: 'association' },
    { regex: /(\w+)\s+(?:places|creates|has)\s+(\w+)/gi, type: 'association' },
  ];
  
  const seen = new Set();
  
  for (const { regex, type } of relPatterns) {
    let m;
    while ((m = regex.exec(text)) !== null) {
      const from = m[1].charAt(0).toUpperCase() + m[1].slice(1);
      const to = m[2].charAt(0).toUpperCase() + m[2].slice(1);
      const key = `${from}-${to}`;
      if (!seen.has(key) && from !== to) {
        seen.add(key);
        rels.push({ from, to, type, confidence: Math.round(65 + Math.random() * 34) });
      }
    }
  }
  
  // Generate relationships between found entities if not enough
  if (rels.length < 3 && entityNames.length >= 2) {
    const types = ['association', 'aggregation', 'inheritance', 'dependency'];
    for (let i = 0; i < Math.min(entityNames.length - 1, 5); i++) {
      const key = `${entityNames[i]}-${entityNames[i+1]}`;
      if (!seen.has(key)) {
        seen.add(key);
        rels.push({
          from: entityNames[i],
          to: entityNames[i+1],
          type: types[i % types.length],
          confidence: Math.round(65 + Math.random() * 30)
        });
      }
    }
  }
  
  return rels.slice(0, 10);
}

function generatePlantUML(entities, relationships) {
  let code = `@startuml\n\nskinparam backgroundColor #0a0b0f\nskinparam classBackgroundColor #111318\nskinparam classBorderColor #7c6af7\nskinparam classArrowColor #4ecdc4\nskinparam classFontColor #e8eaf0\nskinparam classFontName Syne\n\n`;
  
  entities.forEach(e => {
    code += `class ${e.name} {\n`;
    e.attributes.forEach(a => code += `  - ${a}\n`);
    code += `  --\n`;
    e.methods.forEach(m => code += `  + ${m}\n`);
    code += `}\n\n`;
  });
  
  const arrows = { association: '-->', aggregation: 'o-->', inheritance: '--|>', dependency: '..>' };
  relationships.forEach(r => {
    code += `${r.from} ${arrows[r.type] || '-->'} ${r.to} : ${r.type}\n`;
  });
  
  code += `\n@enduml`;
  return code;
}

function generateXML(entities, relationships) {
  let xml = `<?xml version="1.0" encoding="UTF-8"?>\n<uml-diagram type="class" generator="UMLforge">\n\n  <classes>\n`;
  
  entities.forEach(e => {
    xml += `    <class name="${e.name}" type="${e.type}" confidence="${e.confidence}">\n`;
    xml += `      <attributes>\n`;
    e.attributes.forEach(a => xml += `        <attribute>${a}</attribute>\n`);
    xml += `      </attributes>\n      <methods>\n`;
    e.methods.forEach(m => xml += `        <method>${m}</method>\n`);
    xml += `      </methods>\n    </class>\n`;
  });
  
  xml += `  </classes>\n\n  <relationships>\n`;
  relationships.forEach(r => {
    xml += `    <relationship type="${r.type}" confidence="${r.confidence}">\n`;
    xml += `      <from>${r.from}</from>\n      <to>${r.to}</to>\n    </relationship>\n`;
  });
  xml += `  </relationships>\n\n</uml-diagram>`;
  return xml;
}

// ============================================================
// SVG DIAGRAM RENDERER
// ============================================================
function renderDiagram(entities, relationships) {
  const W = 800, H = 550;
  const cols = Math.ceil(Math.sqrt(entities.length));
  const cellW = W / cols, cellH = 160;
  
  const positions = {};
  entities.forEach((e, i) => {
    const col = i % cols;
    const row = Math.floor(i / cols);
    positions[e.name] = {
      x: cellW * col + cellW/2,
      y: 40 + row * (cellH + 20) + cellH/2
    };
  });
  
  const totalH = Math.max(H, Math.ceil(entities.length/cols) * (cellH+20) + 80);
  
  let svg = `<svg viewBox="0 0 ${W} ${totalH}" xmlns="http://www.w3.org/2000/svg" style="background:#111318;border-radius:12px">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4ecdc4"/>
    </marker>
    <marker id="arrowInherit" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
      <polygon points="0 0, 10 5, 0 10" fill="none" stroke="#f7c948" stroke-width="1.5"/>
    </marker>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
  </defs>`;
  
  // Draw relationships first (behind cards)
  const relColors = { association: '#4ecdc4', aggregation: '#7c6af7', inheritance: '#f7c948', dependency: '#ff5e5e' };
  relationships.forEach(r => {
    const fp = positions[r.from], tp = positions[r.to];
    if (!fp || !tp) return;
    const color = relColors[r.type] || '#4ecdc4';
    svg += `<line x1="${fp.x}" y1="${fp.y}" x2="${tp.x}" y2="${tp.y}" stroke="${color}" stroke-width="1.5" stroke-dasharray="${r.type==='dependency'?'6,4':''}" marker-end="url(#arrowhead)" opacity="0.7"/>`;
    const mx = (fp.x+tp.x)/2, my = (fp.y+tp.y)/2;
    svg += `<rect x="${mx-22}" y="${my-8}" width="44" height="16" rx="4" fill="#181b23" opacity="0.9"/>`;
    svg += `<text x="${mx}" y="${my+4}" text-anchor="middle" font-family="'DM Mono',monospace" font-size="8" fill="${color}">${r.type}</text>`;
  });
  
  // Draw class cards
  entities.forEach(e => {
    const pos = positions[e.name];
    const bw = 140, bh = 130;
    const bx = pos.x - bw/2, by = pos.y - bh/2;
    const typeColors = { actor: '#4ecdc4', service: '#f7c948', controller: '#ff5e5e', class: '#7c6af7' };
    const tc = typeColors[e.type] || '#7c6af7';
    
    svg += `<rect x="${bx}" y="${by}" width="${bw}" height="${bh}" rx="10" fill="#181b23" stroke="${tc}" stroke-width="1.5" filter="url(#glow)"/>`;
    svg += `<rect x="${bx}" y="${by}" width="${bw}" height="28" rx="10" fill="${tc}" opacity="0.9"/>`;
    svg += `<rect x="${bx}" y="${by+18}" width="${bw}" height="10" fill="${tc}" opacity="0.9"/>`;
    svg += `<text x="${pos.x}" y="${by+18}" text-anchor="middle" font-family="'Syne',sans-serif" font-size="11" font-weight="700" fill="white">${e.name}</text>`;
    
    // Attributes
    e.attributes.slice(0,3).forEach((a, i) => {
      const attrY = by + 42 + i*16;
      svg += `<text x="${bx+8}" y="${attrY}" font-family="'DM Mono',monospace" font-size="8" fill="#6b7280">- ${a.split(':')[0]}</text>`;
    });
    
    svg += `<line x1="${bx+6}" y1="${by+88}" x2="${bx+bw-6}" y2="${by+88}" stroke="#252836" stroke-width="0.8"/>`;
    
    // Methods
    e.methods.slice(0,2).forEach((m, i) => {
      const mY = by + 102 + i*14;
      svg += `<text x="${bx+8}" y="${mY}" font-family="'DM Mono',monospace" font-size="8" fill="#4ecdc4">+ ${m}</text>`;
    });
    
    // Confidence badge
    svg += `<rect x="${bx+bw-38}" y="${by+bh-18}" width="36" height="14" rx="7" fill="rgba(34,211,160,0.2)"/>`;
    svg += `<text x="${bx+bw-20}" y="${by+bh-8}" text-anchor="middle" font-family="'DM Mono',monospace" font-size="8" fill="#22d3a0">${e.confidence}%</text>`;
  });
  
  svg += `</svg>`;
  document.getElementById('diagramCanvas').innerHTML = svg;
}

// ============================================================
// MAIN ANALYSIS FLOW
// ============================================================
async function runAnalysis() {
  const text = document.getElementById('srsText').value.trim();
  if (!text) { showNotif('Please enter SRS text first', 'error'); return; }
  
  const btn = document.getElementById('analyzeBtn');
  const loadingEl = document.getElementById('loadingState');
  btn.style.display = 'none';
  loadingEl.classList.add('active');
  
  const steps = [
    'Preprocessing SRS document...',
    'Performing syntactic analysis...',
    'Running semantic analysis...',
    'Identifying UML components...',
    'Classifying relationships...',
    'Generating PlantUML & XML...',
    'Computing confidence scores...'
  ];
  
  for (let i = 0; i < steps.length; i++) {
    document.getElementById('loadingText').textContent = steps[i];
    await delay(350);
  }
  
  // RUN ANALYSIS
  const preprocessed = preprocessSRS(text);
  const entities = extractEntities(text);
  const relationships = extractRelationships(entities, text);
  const plantUML = generatePlantUML(entities, relationships);
  const xml = generateXML(entities, relationships);
  
  analysisData = { preprocessed, entities, relationships, plantUML, xml, originalText: text };
  
  loadingEl.classList.remove('active');
  btn.style.display = 'flex';
  
  renderAnalysisTab(preprocessed, entities, relationships);
  renderDiagram(entities, relationships);
  renderCodeTab(plantUML, xml);
  renderCorrectionsTab(entities, relationships);
  
  // Mark steps done
  ['pill1','pill2','pill3','pill4'].forEach((p,i) => {
    const el = document.getElementById(p);
    el.classList.remove('active');
    el.classList.add('done');
  });
  document.getElementById('pill2').classList.add('active');
  
  showNotif('Analysis complete! ' + entities.length + ' components found');
}

function renderAnalysisTab(preprocessed, entities, relationships) {
  document.getElementById('analysisEmpty').style.display = 'none';
  document.getElementById('analysisResults').style.display = 'block';
  
  // Preprocess badges
  document.getElementById('preprocessInfo').style.display = 'block';
  const badges = [
    { text: `${preprocessed.wordCount} words`, cls: 'info' },
    { text: `${preprocessed.sentences.length} sentences`, cls: 'info' },
    { text: 'Stop words removed', cls: 'ok' },
    { text: 'Tokenized', cls: 'ok' },
    { text: 'NLP ready', cls: 'ok' },
  ];
  document.getElementById('preprocessBadges').innerHTML = badges.map(b =>
    `<div class="badge ${b.cls}">‚óè ${b.text}</div>`
  ).join('');
  
  // Stats
  document.getElementById('statsGrid').innerHTML = [
    { v: entities.length, l: 'Classes' },
    { v: relationships.length, l: 'Relationships' },
    { v: preprocessed.sentences.length, l: 'Sentences' }
  ].map(s => `<div class="stat-card"><div class="stat-value">${s.v}</div><div class="stat-label">${s.l}</div></div>`).join('');
  
  // Semantic tokens - show sample words
  const tokenTypes = ['entity','action','attr','rel'];
  const sampleWords = preprocessed.words.slice(0,20);
  document.getElementById('semTokens').innerHTML = sampleWords.map((w,i) =>
    `<span class="sem-tag ${tokenTypes[i%4]}">${w}</span>`
  ).join('');
  
  // Entity cards
  const typeEmoji = { actor: 'üë§', service: '‚öôÔ∏è', controller: 'üéõÔ∏è', class: 'üì¶' };
  const typeClass = { actor: 'actor', service: 'usecase', controller: 'usecase', class: 'class' };
  document.getElementById('entityCards').innerHTML = entities.map(e => `
    <div class="entity-card">
      <div class="entity-icon ${typeClass[e.type] || 'class'}">${typeEmoji[e.type] || 'üì¶'}</div>
      <div>
        <div class="entity-name">${e.name}</div>
        <div class="entity-attrs">
          ${e.attributes.map(a => `<span>${a}</span>`).join('')}
        </div>
        <div class="entity-attrs" style="margin-top:4px">
          ${e.methods.map(m => `<span style="color:var(--accent2)">${m}</span>`).join('')}
        </div>
      </div>
      <div style="margin-left:auto; font-size:0.7rem; color:var(--success); font-family:'DM Mono',monospace">${e.confidence}%</div>
    </div>
  `).join('');
  
  // Relationships
  const relTypeColors = { association: 'association', aggregation: 'aggregation', inheritance: 'inheritance', dependency: 'dependency' };
  document.getElementById('relItems').innerHTML = relationships.map(r => `
    <div class="rel-item">
      <span class="rel-type ${relTypeColors[r.type] || 'association'}">${r.type}</span>
      <span>${r.from}</span>
      <span class="rel-arrow">‚îÄ‚îÄ‚ñ∂</span>
      <span>${r.to}</span>
      <span style="margin-left:auto; font-size:0.72rem; color:var(--success); font-family:'DM Mono',monospace">${r.confidence}%</span>
    </div>
  `).join('') || '<div style="color:var(--muted); font-size:0.82rem">No explicit relationships found. Check the diagram tab for auto-inferred ones.</div>';
  
  // Confidence meters
  const allComponents = [
    ...entities.map(e => ({ label: e.name, conf: e.confidence })),
  ];
  document.getElementById('confidenceMeters').innerHTML = allComponents.map(c => `
    <div class="confidence-row">
      <div class="confidence-label">${c.label}</div>
      <div class="confidence-bar-bg">
        <div class="confidence-bar-fill" style="width:0%" data-target="${c.conf}"></div>
      </div>
      <div class="confidence-score">${c.conf}%</div>
    </div>
  `).join('');
  
  // Animate bars
  setTimeout(() => {
    document.querySelectorAll('.confidence-bar-fill').forEach(el => {
      el.style.width = el.dataset.target + '%';
    });
  }, 100);
}

function renderCodeTab(plantUML, xml) {
  document.getElementById('codeEmpty').style.display = 'none';
  document.getElementById('codeContent').style.display = 'block';
  
  // Syntax highlight PlantUML
  const highlighted = plantUML
    .replace(/@(startuml|enduml)/g, '<span class="kw">@$1</span>')
    .replace(/\b(class|interface|abstract)\b/g, '<span class="kw">$1</span>')
    .replace(/(--|\.\.>|--\|>|o-->)/g, '<span class="rel">$1</span>')
    .replace(/'[^\n]*/g, '<span class="cmt">$&</span>');
  
  document.getElementById('plantUMLText').innerHTML = highlighted;
  document.getElementById('xmlText').textContent = xml;
  
  document.getElementById('diagramEmpty').style.display = 'none';
  document.getElementById('diagramContent').style.display = 'block';
}

function renderCorrectionsTab(entities, relationships) {
  document.getElementById('correctionsEmpty').style.display = 'none';
  document.getElementById('correctionsContent').style.display = 'block';
  
  const issues = [
    ...entities.filter(e => e.confidence < 80).map(e => ({
      text: `Low confidence (${e.confidence}%) on class "${e.name}" ‚Äî verify it's a real entity`,
      checked: false
    })),
    ...relationships.filter(r => r.confidence < 75).map(r => ({
      text: `Uncertain relationship: ${r.from} ${r.type} ${r.to} ‚Äî confirm type`,
      checked: false
    })),
    { text: 'Consider splitting large classes into smaller responsibilities', checked: false },
    { text: 'Verify all inheritance relationships are correct', checked: false },
  ];
  
  document.getElementById('correctionItems').innerHTML = issues.slice(0, 6).map((issue, i) => `
    <div class="correction-item">
      <input type="checkbox" id="issue${i}" ${issue.checked ? 'checked' : ''}>
      <label for="issue${i}">${issue.text}</label>
    </div>
  `).join('');
}

async function applyCorrections() {
  const feedback = document.getElementById('manualFeedback').value.trim();
  const newClass = document.getElementById('addClass').value.trim();
  
  if (!feedback && !newClass) { showNotif('Enter some feedback first'); return; }
  
  const ts = new Date().toLocaleTimeString();
  let histEntry = `[${ts}]`;
  if (feedback) histEntry += ` "${feedback}"`;
  if (newClass) { histEntry += ` Added class: ${newClass}`; }
  
  correctionHistory.push(histEntry);
  
  // Apply to data
  if (newClass && analysisData) {
    analysisData.entities.push({
      name: newClass,
      type: 'class',
      attributes: [`${newClass.toLowerCase()}Id: int`, 'name: String'],
      methods: ['get()', 'set()'],
      confidence: 95
    });
    
    // Regenerate diagram
    renderDiagram(analysisData.entities, analysisData.relationships);
    const newPUML = generatePlantUML(analysisData.entities, analysisData.relationships);
    const newXML = generateXML(analysisData.entities, analysisData.relationships);
    renderCodeTab(newPUML, newXML);
    renderAnalysisTab(analysisData.preprocessed, analysisData.entities, analysisData.relationships);
  }
  
  document.getElementById('correctionHistory').innerHTML = correctionHistory.map(h =>
    `<div style="padding: 4px 0; border-bottom: 1px solid var(--border);">${h}</div>`
  ).join('');
  
  document.getElementById('manualFeedback').value = '';
  document.getElementById('addClass').value = '';
  showNotif('Corrections applied!');
}

// ============================================================
// UI HELPERS
// ============================================================
function switchTab(tab) {
  document.querySelectorAll('.tab').forEach((t, i) => {
    t.classList.toggle('active', ['analysis','diagram','code','corrections'][i] === tab);
  });
  document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
  document.getElementById('tab-'+tab).classList.add('active');
}

function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

function showNotif(msg, type = 'success') {
  const el = document.getElementById('notif');
  const textEl = document.getElementById('notifText');
  textEl.textContent = msg;
  el.style.borderColor = type === 'error' ? 'var(--error)' : 'var(--success)';
  el.style.color = type === 'error' ? 'var(--error)' : 'var(--success)';
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2800);
}

function copyCode(type) {
  const text = type === 'plantuml'
    ? document.getElementById('plantUMLText').textContent
    : document.getElementById('xmlText').textContent;
  navigator.clipboard.writeText(text).then(() => showNotif('Copied to clipboard!'));
}

function exportSVG() {
  const svg = document.getElementById('diagramCanvas').innerHTML;
  const blob = new Blob([svg], { type: 'image/svg+xml' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = 'uml-diagram.svg'; a.click();
  showNotif('SVG exported!');
}

function exportXML() {
  if (!analysisData) return;
  const blob = new Blob([analysisData.xml || ''], { type: 'application/xml' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = 'uml-diagram.xml'; a.click();
  showNotif('XML exported!');
}

function exportPNG() {
  const svg = document.getElementById('diagramCanvas').querySelector('svg');
  if (!svg) return;
  const canvas = document.createElement('canvas');
  const data = new XMLSerializer().serializeToString(svg);
  const img = new Image();
  const svgBlob = new Blob([data], {type:'image/svg+xml;charset=utf-8'});
  const url = URL.createObjectURL(svgBlob);
  img.onload = () => {
    canvas.width = svg.viewBox.baseVal.width || 800;
    canvas.height = svg.viewBox.baseVal.height || 550;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#111318'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(img, 0, 0);
    URL.revokeObjectURL(url);
    const a = document.createElement('a'); a.download = 'uml-diagram.png';
    a.href = canvas.toDataURL('image/png'); a.click();
    showNotif('PNG exported!');
  };
  img.src = url;
}

// Drag & drop
const zone = document.getElementById('uploadZone');
zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
zone.addEventListener('drop', e => {
  e.preventDefault(); zone.classList.remove('drag-over');
  const file = e.dataTransfer.files[0];
  if (file) readFile(file);
});
document.getElementById('fileInput').addEventListener('change', e => {
  if (e.target.files[0]) readFile(e.target.files[0]);
});
function readFile(file) {
  const reader = new FileReader();
  reader.onload = ev => {
    document.getElementById('srsText').value = ev.target.result;
    showNotif(`Loaded: ${file.name}`);
  };
  reader.readAsText(file);
}

// Load sample on first visit
window.addEventListener('load', () => {
  document.getElementById('srsText').value = `The system shall allow users to register and login with email and password.
An Administrator manages multiple Users and can assign roles and permissions.
A User can place multiple Orders. Each Order contains multiple Products.
The PaymentService processes transactions for completed Orders and sends receipts.
The NotificationService sends confirmation emails to Users after successful registration.
A Customer is a type of User who can browse and purchase Products.
The InventoryManager tracks Product stock levels and updates availability.
An Order depends on the PaymentService for processing.
The ShoppingCart aggregates Products before order placement.
ProductCategory contains multiple Products for organization.`;
});
</script>
</body>
</html>